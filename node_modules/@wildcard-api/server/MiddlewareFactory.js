"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MiddlewareFactory = void 0;
const autoLoadEndpointFiles_1 = require("./autoLoadEndpointFiles");
const global_instance_1 = require("./global-instance");
function createMiddleware(serverAdapter, __INTERNAL_wildcardServer_middleware, adapterOptions, setContext, __INTERNAL_universalAdapter) {
    const middleware = serverAdapter([requestHandler], adapterOptions);
    return middleware;
    function requestHandler(requestObject, { requestProps }) {
        const wildcardServer = __INTERNAL_wildcardServer_middleware
            ? __INTERNAL_wildcardServer_middleware.wildcardServer
            : global_instance_1.wildcardServer;
        if (!__INTERNAL_wildcardServer_middleware &&
            Object.keys(wildcardServer.endpoints).length === 0) {
            autoLoadEndpointFiles_1.autoLoadEndpointFiles();
        }
        const context = (setContext === null || setContext === void 0 ? void 0 : setContext.bind) ? setContext.bind(null, requestObject)
            : setContext;
        return wildcardServer.getApiHttpResponse(requestProps, context, {
            __INTERNAL_universalAdapter,
        });
    }
}
function MiddlewareFactory(serverAdapter, __INTERNAL_universalAdapter, adapterOptions) {
    return wildcard;
    /**
     * Set the context object - the endpoint functions' `this`.
     * @callback setContext
     * @param req The request object provided by server framework (Epxress, Koa, or Hapi).
     * @returns The context object - the endpoint functions' `this`.
     */
    /**
     * Create a Wildcard server middleware.
     * @param [setContext] Set the context object - the endpoint functions' `this`.
     * @returns Server middleware.
     */
    function wildcard(setContext, 
    /** @ignore */
    { __INTERNAL_wildcardServer_middleware } = {}) {
        const middleware = createMiddleware(serverAdapter, __INTERNAL_wildcardServer_middleware, adapterOptions, setContext, __INTERNAL_universalAdapter);
        return middleware;
    }
}
exports.MiddlewareFactory = MiddlewareFactory;
//# sourceMappingURL=MiddlewareFactory.js.map